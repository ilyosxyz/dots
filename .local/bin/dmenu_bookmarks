#!/bin/sh

file="$HOME/.local/share/bookmarks"

menu(){
  list="$(grep -v '^#' "$file" 2>/dev/null)"
  
  if [ -z "$list" ]; then
    notify-send "No bookmarks" "Check $file"
  else
    bookmark="$(grep -v -E '^#|^\s*$' "$file" | dmenu -i -l 10 | cut -d' ' -f1)"
    
    [ -z "$bookmark" ] && exit 1

    xdotool type --delay 0 "$bookmark"
  fi
}

add() {
  bookmark="$(xclip -o)"
  note="$(dmenu -p "note:" <&-)"
  
  if grep -q "^$bookmark" "$file"; then
    notify-send "Oops!" "Already bookmarked"
  else
    if [ -z "$note" ]; then
      echo "$bookmark" >> "$file"
    else
      echo "$bookmark $note" >> "$file"
    fi
    notify-send "Bookmarked!"
  fi
}

edit() {
  xdg-open "$file"
}

case "$1" in
  add)  add;;
  edit) edit;;
  *)    menu;;
esac
